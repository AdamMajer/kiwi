<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<html>
<head>
<title>KIWIRuntimeChecker Info</title>
</head>
<body text="#000000" bgcolor="#E8E8FF" link="#3333FF" vlink="#663366" alink="#FF0000">
<center><h1>KIWIRuntimeChecker Info</h1></center>
<p>
<hr>
<a name="TOP"></a>
<h2>Public methods</h2>
<p>
<ul>
<li><a href="#createChecks">createChecks</a></li>
<li><a href="#new">new</a></li>
<li><a href="#prepareChecks">prepareChecks</a></li>
</ul>
<h2>Private methods</h2>
<p>
<ul>
<li><a href="#__checkContainerHasLXC">__checkContainerHasLXC</a></li>
<li><a href="#__checkCorrectRootFSPermissons">__checkCorrectRootFSPermissons</a></li>
<li><a href="#__checkFilesystemTool">__checkFilesystemTool</a></li>
<li><a href="#__checkHaveTypeToBuild">__checkHaveTypeToBuild</a></li>
<li><a href="#__checkLVMoemSizeSettings">__checkLVMoemSizeSettings</a></li>
<li><a href="#__checkOEMsizeSettingSufficient">__checkOEMsizeSettingSufficient</a></li>
<li><a href="#__checkPackageManagerExists">__checkPackageManagerExists</a></li>
<li><a href="#__checkPatternTypeAttrValueConsistent">__checkPatternTypeAttrValueConsistent</a></li>
<li><a href="#__checkProfileConsistent">__checkProfileConsistent</a></li>
<li><a href="#__checkRepoAliasUnique">__checkRepoAliasUnique</a></li>
<li><a href="#__checkRootRecycleCapability">__checkRootRecycleCapability</a></li>
<li><a href="#__checkSelectedBootLoaderIncluded">__checkSelectedBootLoaderIncluded</a></li>
<li><a href="#__checkSwapRecommended">__checkSwapRecommended</a></li>
<li><a href="#__checkSystemDiskData">__checkSystemDiskData</a></li>
<li><a href="#__checkTargetLocation">__checkTargetLocation</a></li>
<li><a href="#__checkUsersConsistent">__checkUsersConsistent</a></li>
<li><a href="#__checkVMConfigExist">__checkVMConfigExist</a></li>
<li><a href="#__checkVMControllerCapable">__checkVMControllerCapable</a></li>
<li><a href="#__checkVMConverterExist">__checkVMConverterExist</a></li>
<li><a href="#__checkVMdiskmodeCapable">__checkVMdiskmodeCapable</a></li>
<li><a href="#__checkVolumeSetup">__checkVolumeSetup</a></li>
<li><a href="#__checkYaSTenvironment">__checkYaSTenvironment</a></li>
<li><a href="#__hasBootDescription">__hasBootDescription</a></li>
<li><a href="#__hasBootLoaderTools">__hasBootLoaderTools</a></li>
<li><a href="#__hasContainerName">__hasContainerName</a></li>
<li><a href="#__hasValidArchives">__hasValidArchives</a></li>
<li><a href="#__hasValidLVMName">__hasValidLVMName</a></li>
<li><a href="#__haveValidTypeString">__haveValidTypeString</a></li>
<li><a href="#__here_format">__here_format</a></li>
<li><a href="#__isFsToolAvailable">__isFsToolAvailable</a></li>
<li><a href="#__isoHybridCapable">__isoHybridCapable</a></li>
<li><a href="#__read_pids">__read_pids</a></li>
</ul>
<hr>
<a name="createChecks"><h2>createChecks</h2></a>
<p>
     Runtime checks specific to the create step
<p>
Defined on line: 106
<p>
Called in
<ul>
<li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 766</li></ul>
<a name="new"><h2>new</h2></a>
<p>
     Create the RuntimChecker object
<p>
Defined on line: 61
<p>
Called in
<ul>
<li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 467</li><li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 533</li><li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 742</li></ul>
<a name="prepareChecks"><h2>prepareChecks</h2></a>
<p>
     Runtime checks specific to the prepare step
<p>
Defined on line: 192
<p>
Called in
<ul>
<li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 475</li><li><a href="KIWIImageCreator.html">KIWIImageCreator</a> : 563</li></ul>
<a name="__checkContainerHasLXC"><h2>__checkContainerHasLXC</h2></a>
<p>
     A container build must include the lxc package
<p>
Defined on line: 457
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 126</li></ul>
<a name="__checkCorrectRootFSPermissons"><h2>__checkCorrectRootFSPermissons</h2></a>
<p>
Missing<p>
Defined on line: 1867
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 123</li></ul>
<a name="__checkFilesystemTool"><h2>__checkFilesystemTool</h2></a>
<p>
     Check that the build system has the necessary file
     system tools installed for the requested build.
<p>
Defined on line: 585
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 141</li></ul>
<a name="__checkHaveTypeToBuild"><h2>__checkHaveTypeToBuild</h2></a>
<p>
Missing<p>
Defined on line: 676
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 138</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 227</li></ul>
<a name="__checkLVMoemSizeSettings"><h2>__checkLVMoemSizeSettings</h2></a>
<p>
     Verify that the specified LVM size requirements do not
     exceed the specified OEM system size if specified
<p>
Defined on line: 490
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 165</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 230</li></ul>
<a name="__checkOEMsizeSettingSufficient"><h2>__checkOEMsizeSettingSufficient</h2></a>
<p>
     Verify that the image fits within the specified size
<p>
Defined on line: 691
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 144</li></ul>
<a name="__checkPackageManagerExists"><h2>__checkPackageManagerExists</h2></a>
<p>
     Check that the specified package manager exists
<p>
Defined on line: 739
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 147</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 233</li></ul>
<a name="__checkPatternTypeAttrValueConsistent"><h2>__checkPatternTypeAttrValueConsistent</h2></a>
<p>
     Check that the use of the patternType attribute for the <packages>
     element is consistent. The static component of this is checked during
     XML validation. If no profiles are specified on the command line
     or if the configuration contains a <packages> element without a
     profile attribute there is nothing to do.
<p>
Defined on line: 782
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 236</li></ul>
<a name="__checkProfileConsistent"><h2>__checkProfileConsistent</h2></a>
<p>
     Check if the selected profiles exists
<p>
Defined on line: 763
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 132</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 224</li></ul>
<a name="__checkRepoAliasUnique"><h2>__checkRepoAliasUnique</h2></a>
<p>
     Verify that the repo alias is unique across the currently active repos
<p>
Defined on line: 835
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 239</li></ul>
<a name="__checkRootRecycleCapability"><h2>__checkRootRecycleCapability</h2></a>
<p>
     Check the root tree if --recycle-root is set. In that case
     it's not allowed to use a root tree which is based on
     an image cache
<p>
Defined on line: 895
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 242</li></ul>
<a name="__checkSelectedBootLoaderIncluded"><h2>__checkSelectedBootLoaderIncluded</h2></a>
<p>
     check if the selected bootloader will also be installed into
     the image. This is required for the oem, vmx and pxe image
     types. In case of a pxe type the deploy configuration might
     not require a bootloader e.g for remote root systems. As we
     don't know the deploy configuration at build time the check
     might complain unnecessarily. In such a case add the package
     in question and remove it in config.sh again.
<p>
Defined on line: 402
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 129</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 218</li></ul>
<a name="__checkSwapRecommended"><h2>__checkSwapRecommended</h2></a>
<p>
Missing<p>
Defined on line: 327
<a name="__checkSystemDiskData"><h2>__checkSystemDiskData</h2></a>
<p>
Missing<p>
Defined on line: 993
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 171</li></ul>
<a name="__checkTargetLocation"><h2>__checkTargetLocation</h2></a>
<p>
     Any given target directory must be outside of /var/cache/kiwi
     to avoid busy mount because kiwi bind mounts the cache directory
     into the image root tree to access host caching information
<p>
Defined on line: 864
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 117</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 206</li></ul>
<a name="__checkUsersConsistent"><h2>__checkUsersConsistent</h2></a>
<p>
     User definitions may conflict in different profiles in the
     static definition. However, at build time only profiles with
     non conflicting user definitions may be selected.
<p>
Defined on line: 1101
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 245</li></ul>
<a name="__checkVMConfigExist"><h2>__checkVMConfigExist</h2></a>
<p>
     Check that a machine config exists for some formats
<p>
Defined on line: 1158
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 114</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 203</li></ul>
<a name="__checkVMControllerCapable"><h2>__checkVMControllerCapable</h2></a>
<p>
     If a VM image is being built and the specified vmdisk controller,
     then the qemu-img command on the system must support this option.
<p>
Defined on line: 1187
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 153</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 254</li></ul>
<a name="__checkVMConverterExist"><h2>__checkVMConverterExist</h2></a>
<p>
     Check that the preferred converter exists
<p>
Defined on line: 1119
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 150</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 251</li></ul>
<a name="__checkVMdiskmodeCapable"><h2>__checkVMdiskmodeCapable</h2></a>
<p>
     qemu-img command must support specified diskmode
<p>
Defined on line: 1255
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 156</li></ul>
<a name="__checkVolumeSetup"><h2>__checkVolumeSetup</h2></a>
<p>
Missing<p>
Defined on line: 921
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 168</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 197</li></ul>
<a name="__checkYaSTenvironment"><h2>__checkYaSTenvironment</h2></a>
<p>
Missing<p>
Defined on line: 278
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 215</li></ul>
<a name="__hasBootDescription"><h2>__hasBootDescription</h2></a>
<p>
     Check if the boot description exists according
     to the selected image type
<p>
Defined on line: 1552
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 180</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 263</li></ul>
<a name="__hasBootLoaderTools"><h2>__hasBootLoaderTools</h2></a>
<p>
     Check if the system will work if the use of
     a boot partition is switched off
    
    my $this = shift;
    my $kiwi = $this->{kiwi};
    my $locator = $this->{locator};
    my $xml = $this->{xml};
    my $bldType = $xml -> getImageType();
    if (! $bldType) {
        return 1;
    }
    my $bootpartition = $bldType -> getBootPartition();
    my $filesystem = $bldType -> getFilesystem();
    if ((! $bootpartition) || ($bootpartition eq "true")) {
        return 1;
    }
    if ($filesystem !~ /btrfs|zfs|xfs/) {
        return 1;
    }
    my $bootloader = $bldType -> getBootLoader();
    if ($bootloader ne "grub2") {
        my $msg = "The system is explicitly configured to work ";
        $msg.= "without a boot partition for the $filesystem filesystem. ";
        $msg.= "But this is only supported with the grub2 bootloader. ";
        $msg.= "The currently configured $bootloader bootloader is not ";
        $msg.= "supported in this setup";
        $kiwi -> error($msg);
        $kiwi -> failed();
        return;
    }
    return 1;
}

==========================================
 __checkBootPartitionOverlaySystem
------------------------------------------
     Check the boot partition setup for overlay systems
    
    my $this = shift;
    my $kiwi = $this->{kiwi};
    my $locator = $this->{locator};
    my $xml = $this->{xml};
    my $bldType = $xml -> getImageType();
    if (! $bldType) {
        return 1;
    }
    my $typename = $bldType -> getTypeName();
    my $bootpartition = $bldType -> getBootPartition();
    my $filesystem = $bldType -> getFilesystem();
    if ((! $bootpartition) || ($bootpartition eq "true")) {
        return 1;
    }
    if ($filesystem !~ /overlayfs|clicfs/) {
        return 1;
    }
    my $msg = "The system is explicitly configured to work as root overlay ";
    $msg.= "system without a boot partition for the $filesystem filesystem. ";
    $msg.= "However the the boot location must be writable and can't be ";
    $msg.= "part of the read only root filesystem. Please delete the ";
    $msg.= "bootpartition attribute from your $typename build type";
    $kiwi -> error($msg);
    $kiwi -> failed();
    return;
}

==========================================
 __checkDeprecatedFilesystem
------------------------------------------
    my $this = shift;
    my $kiwi = $this->{kiwi};
    my $xml = $this->{xml};
    my $bldType = $xml -> getImageType();
    if (! $bldType) {
        return 1;
    }
    my $filesystem = $bldType -> getFilesystem();
    my $flag = $bldType -> getFlags();
    if (($filesystem && $filesystem eq 'clicfs') ||
        ($flag && $flag eq 'clic')) {
        $kiwi -> warning(
            "The use of clicfs is obsolete, consider using overlayfs"
        );
        $kiwi -> oops();
        return 1;
    }
    return 1;
}

==========================================
 __checkMountDependencies
------------------------------------------
    my $this = shift;
    my $kiwi = $this->{kiwi};
    my $msg;
    if ($ENV{KIWI_IGNORE_OLD_MOUNTS}) {
        return 1;
    }
    my %proc_result;
    foreach my $pid ($this->__read_pids('/proc')) {
        foreach my $task_pid ($this->__read_pids("/proc/$pid/task")) {
            my $TASK_MOUNTS = FileHandle->new();
            if ($TASK_MOUNTS->open("/proc/$pid/task/$task_pid/mounts")) {
                while (my $line = <$TASK_MOUNTS>) {
                     The search expression to indicate this mount belongs to
                     some kiwi process is not 100% reliable, but so far the
                     only solution I could come up with
                    if ($line =~ /kiwi/) {
                        $proc_result{$task_pid} = 1;
                    }
                }
                $TASK_MOUNTS->close();
            }
        }
    }
    my @kiwi_mount_references = sort keys %proc_result;
    if (! @kiwi_mount_references) {
        return 1;
    }

    $msg = <<'    END_MESSAGE';
    It appears there are processes which are holding onto
    mounts created by a previous run
    END_MESSAGE
    $kiwi->error($this->__here_format($msg));

    my $PS = FileHandle->new();
    if ($PS->open("pstree -p|")) {
        while (my $line = <$PS>) {
            foreach my $ref_pid (@kiwi_mount_references) {
                if ($line =~ /\($ref_pid\)/) {
                    $kiwi->note($line);
                    last;
                }
            }
        }
        $PS -> close();
    }
    $kiwi->note("\n");

    $msg = <<'    END_MESSAGE';
    This could cause kiwi to fail, or even worse, if you are
    building on tmpfs, it could totally freeze or crash your
    machine. Please first clean up these old mounts, or export
    'KIWI_IGNORE_OLD_MOUNTS=yes' and re-run
    END_MESSAGE
    $kiwi->error($this->__here_format($msg));

    return;
}

==========================================
 __hasBootLoaderTools
------------------------------------------
     Check if the selected bootloader can be installed
<p>
Defined on line: 1743
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 174</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 257</li></ul>
<a name="__hasContainerName"><h2>__hasContainerName</h2></a>
<p>
     if the image type is docker or lxc a container name
     must be specified
<p>
Defined on line: 1417
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 183</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 266</li></ul>
<a name="__hasValidArchives"><h2>__hasValidArchives</h2></a>
<p>
     check if the optional given archives doesn't
     include bogus files
<p>
Defined on line: 1358
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 248</li></ul>
<a name="__hasValidLVMName"><h2>__hasValidLVMName</h2></a>
<p>
     check if the optional LVM group name doesn't
     exist on the build host
<p>
Defined on line: 1312
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 159</li></ul>
<a name="__haveValidTypeString"><h2>__haveValidTypeString</h2></a>
<p>
     if the commandline data set contains buildtype
     information, check if it contains a valid string
     This check must be done for prepare and create in
     order to early detect a broken commandline when
     using prepare + create in one call by the --build
     option
<p>
Defined on line: 1448
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 135</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 221</li></ul>
<a name="__here_format"><h2>__here_format</h2></a>
<p>
     message text formatter for result of here documents
<p>
Defined on line: 1923
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 1713</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 1735</li></ul>
<a name="__isFsToolAvailable"><h2>__isFsToolAvailable</h2></a>
<p>
     Find the tool for a given filesystem name
<p>
Defined on line: 1507
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 605</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 625</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 628</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 631</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 653</li></ul>
<a name="__isoHybridCapable"><h2>__isoHybridCapable</h2></a>
<p>
     If an ISO image is being built check that if an iso hybrid is
     requested, the platform is capable. Check if the uefi capability
     exists if isohybrid is allowed on given platform.
<p>
Defined on line: 1798
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 162</li></ul>
<a name="__read_pids"><h2>__read_pids</h2></a>
<p>
     proc data help method, to read process ID entries
<p>
Defined on line: 1903
<p>
Called in
<ul>
<li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 1688</li><li><a href="KIWIRuntimeChecker.html">KIWIRuntimeChecker</a> : 1689</li></ul>
